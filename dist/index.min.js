"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),assign=_interopDefault(require("object-assign")),PropTypes=_interopDefault(require("prop-types"));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}var ERR_SPA_UNAVALIABLE="frosmo.spa is not available, fallback to console.error";function error(e){window&&window.frosmo&&window.frosmo.spa||(console.warn(ERR_SPA_UNAVALIABLE),console.error(e)),window.frosmo.spa.log.error(e,"spa.react.placement")}var logger={error:error},DOM_EVENT_FROSMO_SPA_READY="frosmo.spa.ready",ModificationService=function(){function o(e){var t=e.id,n=e.onComplete;_classCallCheck(this,o);this._id=t,this._func=n||function(){},this._modificationContextHandle=null,this._fetchModifications=this._fetchModifications.bind(this)}return _createClass(o,[{key:"fetch",value:function(){window&&(window.frosmo&&window.frosmo.spa?this._fetchModifications():window.addEventListener?window.addEventListener(DOM_EVENT_FROSMO_SPA_READY,this._fetchModifications):window.attachEvent?window.attachEvent(DOM_EVENT_FROSMO_SPA_READY,this._fetchModifications):logger.error("Event cannot be attached"))}},{key:"_fetchModifications",value:function(){var t=this;this._modificationContextHandle=window.frosmo.spa.requestBySelector(this._id),this._modificationContextHandle.then(function(e){return t._func(e)}).catch(function(e){logger.error(e),t._func(null)})}},{key:"cancel",value:function(){this._modificationContextHandle&&(this._modificationContextHandle.cancel(),this._modificationContextHandle=null),window.removeEventListener?window.removeEventListener(DOM_EVENT_FROSMO_SPA_READY,this._fetchModifications):window.detachEvent?window.detachEvent(DOM_EVENT_FROSMO_SPA_READY,this._fetchModifications):logger.error("Event cannot be detached"),this._func=null}}]),o}();function withMessage(t){return function(e){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).state={isReady:!1,modificationContext:null},t._modificationContextService=new ModificationService({id:e.id,onComplete:function(e){t.setState({modificationContext:e,isReady:!0})}}),t}return _inherits(n,React.Component),_createClass(n,[{key:"componentWillUnmount",value:function(){this._modificationContextService.cancel()}},{key:"componentDidMount",value:function(){this._modificationContextService.fetch()}},{key:"render",value:function(){return this.state.isReady?React__default.createElement(t,_extends({modificationContext:this.state.modificationContext},this.props)):null}}]),n}()}var _createReactElement=function(e){return e?React__default.createElement(e):null},hasChildren=function(e){return e&&0<React__default.Children.count(e)},buildMessageProps=function(e){return _objectSpread({},e.params,{frosmoModificationContext:e})},createReactComponent=function(e,t,n){return e?React__default.createElement(e,n):hasChildren(t)?React__default.Children.map(t,function(e){var t=assign({},e.props,n);return React__default.createElement(e.type,t)}):null},_renderSuccess=function(e){var t=e.children,n=e.component,o=e.defaultComponent,r=e.modificationContext,i=buildMessageProps(r),a=createReactComponent(n,t,i);return a?(r.setDisplayed(),a):_createReactElement(o)};function ChildComponent(e){var t=e.defaultComponent;return null!==e.modificationContext?_renderSuccess(e):_createReactElement(t)}var ModificationContextPropTypes={variation:PropTypes.number.isRequired,params:PropTypes.object.isRequired,content:PropTypes.string.isRequired,setDisplayed:PropTypes.func.isRequired,setClicked:PropTypes.func.isRequired,setTrueDisplayed:PropTypes.func.isRequired,setTrackableElements:PropTypes.func.isRequired,startTracking:PropTypes.func.isRequired,error:PropTypes.func.isRequired,clear:PropTypes.func.isRequired},FrosmoPropTypes={children:PropTypes.node,component:PropTypes.oneOfType([PropTypes.node,PropTypes.elementType]),defaultComponent:PropTypes.oneOfType([PropTypes.node,PropTypes.elementType]),modificationContext:PropTypes.exact(ModificationContextPropTypes)},FrosmoComponentDefaultProps={children:null,component:null,defaultComponent:null,modificationContext:null},FrosmoPlacement=function(e){function n(e){var t;if(_classCallCheck(this,n),t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e)),!e.id)throw new Error('FrosmoPlacement: "id" property missing.',e);return t}return _inherits(n,React.Component),_createClass(n,[{key:"componentDidMount",value:function(){var e=this.props.modificationContext;null!==e&&(e.setTrackableElements(this.frosmoMessage),e.startTracking())}},{key:"render",value:function(){var t=this,e=React__default.createElement(ChildComponent,this.props);return this.props.useFragment?React__default.createElement(React__default.Fragment,null,e):React__default.createElement("div",{"data-frosmo-elementid":this.props.id,ref:function(e){t.frosmoMessage=e}},e)}}]),n}();FrosmoPlacement.propTypes=FrosmoPropTypes,FrosmoPlacement.defaultProps=FrosmoComponentDefaultProps;var FrosmoPlacement$1=withMessage(FrosmoPlacement);exports.FrosmoPlacement=FrosmoPlacement$1;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgubWluLmpzIiwic291cmNlcyI6WyIuLi9zcmMvdXRpbHMvbG9nZ2VyLmpzIiwiLi4vc3JjL3NlcnZpY2VzL01vZGlmaWNhdGlvblNlcnZpY2UuanMiLCIuLi9zcmMvY29tcG9uZW50cy9ob2NzL3dpdGhNZXNzYWdlLmpzIiwiLi4vc3JjL2NvbXBvbmVudHMvZnJvc21vLXBsYWNlbWVudC9DaGlsZENvbXBvbmVudC5qcyIsIi4uL3NyYy9jb21wb25lbnRzL2Zyb3Ntby1wbGFjZW1lbnQvc2hhcGVzLmpzIiwiLi4vc3JjL2NvbXBvbmVudHMvZnJvc21vLXBsYWNlbWVudC9Gcm9zbW9QbGFjZW1lbnQuanMiLCIuLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiXG5jb25zdCBFUlJfU1BBX1VOQVZBTElBQkxFID0gJ2Zyb3Ntby5zcGEgaXMgbm90IGF2YWlsYWJsZSwgZmFsbGJhY2sgdG8gY29uc29sZS5lcnJvcic7XG5cbmZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UpIHtcbiAgICBpZiAoIXdpbmRvdyB8fCAhd2luZG93LmZyb3NtbyB8fCAhd2luZG93LmZyb3Ntby5zcGEpIHtcbiAgICAgICAgY29uc29sZS53YXJuKEVSUl9TUEFfVU5BVkFMSUFCTEUpO1xuICAgICAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHdpbmRvdy5mcm9zbW8uc3BhLmxvZy5lcnJvcihtZXNzYWdlLCAnc3BhLnJlYWN0LnBsYWNlbWVudCcpO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gICAgZXJyb3IsXG59XG4iLCJpbXBvcnQgbG9nZ2VyIGZyb20gXCIuLi91dGlscy9sb2dnZXJcIjtcblxuY29uc3QgRE9NX0VWRU5UX0ZST1NNT19TUEFfUkVBRFkgPSAnZnJvc21vLnNwYS5yZWFkeSc7XG5cblxuY2xhc3MgTW9kaWZpY2F0aW9uU2VydmljZSB7XG4gICAgY29uc3RydWN0b3IoeyBpZCwgb25Db21wbGV0ZSB9KSB7XG4gICAgICAgIGNvbnN0IG5vb3AgPSAoKSA9PiB7fTtcblxuICAgICAgICB0aGlzLl9pZCA9IGlkO1xuICAgICAgICB0aGlzLl9mdW5jID0gb25Db21wbGV0ZSB8fCBub29wO1xuXG4gICAgICAgIHRoaXMuX21vZGlmaWNhdGlvbkNvbnRleHRIYW5kbGUgPSBudWxsO1xuICAgICAgICB0aGlzLl9mZXRjaE1vZGlmaWNhdGlvbnMgPSB0aGlzLl9mZXRjaE1vZGlmaWNhdGlvbnMuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBmZXRjaCgpIHtcbiAgICAgICAgaWYgKCF3aW5kb3cpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh3aW5kb3cuZnJvc21vICYmIHdpbmRvdy5mcm9zbW8uc3BhKSB7XG4gICAgICAgICAgICB0aGlzLl9mZXRjaE1vZGlmaWNhdGlvbnMoKTtcbiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoRE9NX0VWRU5UX0ZST1NNT19TUEFfUkVBRFksIHRoaXMuX2ZldGNoTW9kaWZpY2F0aW9ucyk7XG4gICAgICAgIH0gZWxzZSBpZiAod2luZG93LmF0dGFjaEV2ZW50KSB7XG4gICAgICAgICAgICB3aW5kb3cuYXR0YWNoRXZlbnQoRE9NX0VWRU5UX0ZST1NNT19TUEFfUkVBRFksIHRoaXMuX2ZldGNoTW9kaWZpY2F0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ0V2ZW50IGNhbm5vdCBiZSBhdHRhY2hlZCcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2ZldGNoTW9kaWZpY2F0aW9ucygpIHtcbiAgICAgICAgdGhpcy5fbW9kaWZpY2F0aW9uQ29udGV4dEhhbmRsZSA9IHdpbmRvdy5mcm9zbW8uc3BhLnJlcXVlc3RCeVNlbGVjdG9yKHRoaXMuX2lkKTtcbiAgICAgICAgdGhpcy5fbW9kaWZpY2F0aW9uQ29udGV4dEhhbmRsZVxuICAgICAgICAgICAgLnRoZW4oY29udGV4dCA9PiB0aGlzLl9mdW5jKGNvbnRleHQpKVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2Z1bmMobnVsbCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjYW5jZWwoKSB7XG4gICAgICAgIGlmICh0aGlzLl9tb2RpZmljYXRpb25Db250ZXh0SGFuZGxlKSB7XG4gICAgICAgICAgICB0aGlzLl9tb2RpZmljYXRpb25Db250ZXh0SGFuZGxlLmNhbmNlbCgpO1xuICAgICAgICAgICAgdGhpcy5fbW9kaWZpY2F0aW9uQ29udGV4dEhhbmRsZSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAod2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgICAgIERPTV9FVkVOVF9GUk9TTU9fU1BBX1JFQURZLFxuICAgICAgICAgICAgICAgIHRoaXMuX2ZldGNoTW9kaWZpY2F0aW9uc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuZGV0YWNoRXZlbnQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5kZXRhY2hFdmVudChcbiAgICAgICAgICAgICAgICBET01fRVZFTlRfRlJPU01PX1NQQV9SRUFEWSxcbiAgICAgICAgICAgICAgICB0aGlzLl9mZXRjaE1vZGlmaWNhdGlvbnNcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ0V2ZW50IGNhbm5vdCBiZSBkZXRhY2hlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZnVuYyA9IG51bGw7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBNb2RpZmljYXRpb25TZXJ2aWNlO1xuIiwiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBNb2RpZmljYXRpb25TZXJ2aWNlIGZyb20gJy4uLy4uL3NlcnZpY2VzL01vZGlmaWNhdGlvblNlcnZpY2UnO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHdpdGhNZXNzYWdlKFdyYXBwZWRDb21wb25lbnQpIHtcbiAgICByZXR1cm4gY2xhc3MgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgICAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgICAgIGlzUmVhZHk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG1vZGlmaWNhdGlvbkNvbnRleHQ6IG51bGwsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLl9tb2RpZmljYXRpb25Db250ZXh0U2VydmljZSA9IG5ldyBNb2RpZmljYXRpb25TZXJ2aWNlKHtcbiAgICAgICAgICAgICAgICBpZDogcHJvcHMuaWQsXG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZTogKG1vZGlmaWNhdGlvbkNvbnRleHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmljYXRpb25Db250ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNSZWFkeTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgICAgIHRoaXMuX21vZGlmaWNhdGlvbkNvbnRleHRTZXJ2aWNlLmNhbmNlbCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgICAgICB0aGlzLl9tb2RpZmljYXRpb25Db250ZXh0U2VydmljZS5mZXRjaCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVuZGVyKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmlzUmVhZHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIDxXcmFwcGVkQ29tcG9uZW50XG4gICAgICAgICAgICAgICAgbW9kaWZpY2F0aW9uQ29udGV4dD17dGhpcy5zdGF0ZS5tb2RpZmljYXRpb25Db250ZXh0fVxuICAgICAgICAgICAgICAgIHsuLi50aGlzLnByb3BzIH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IGFzc2lnbiBmcm9tICdvYmplY3QtYXNzaWduJztcblxuXG5jb25zdCBfY3JlYXRlUmVhY3RFbGVtZW50ID0gY29tcG9uZW50ID0+XG4gICAgY29tcG9uZW50XG4gICAgICAgID8gUmVhY3QuY3JlYXRlRWxlbWVudChjb21wb25lbnQpXG4gICAgICAgIDogbnVsbDtcblxuY29uc3QgaGFzQ2hpbGRyZW4gPSAoY2hpbGRyZW4pID0+IGNoaWxkcmVuICYmIFJlYWN0LkNoaWxkcmVuLmNvdW50KGNoaWxkcmVuKSA+IDA7XG5jb25zdCBidWlsZE1lc3NhZ2VQcm9wcyA9IChtb2RpZmljYXRpb25Db250ZXh0KSA9PiB7XG4gICAgLy8gU2V0IHRlbXBsYXRlRGVmYXVsdHMgYXMgcHJvcHNcbiAgICBjb25zdCB7IHBhcmFtcyB9ID0gbW9kaWZpY2F0aW9uQ29udGV4dDtcblxuICAgIC8vIEJ1aWxkIHByb3BzIGZvciBtb2RpZmljYXRpb24gY29tcG9uZW50XG4gICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucGFyYW1zLFxuICAgICAgICBmcm9zbW9Nb2RpZmljYXRpb25Db250ZXh0OiBtb2RpZmljYXRpb25Db250ZXh0LFxuICAgIH07XG59O1xuXG5jb25zdCBjcmVhdGVSZWFjdENvbXBvbmVudCA9IChjb21wb25lbnQsIGNoaWxkcmVuLCBtZXNzYWdlUHJvcHMpID0+IHtcbiAgICBpZiAoY29tcG9uZW50KSB7XG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KGNvbXBvbmVudCwgbWVzc2FnZVByb3BzKTtcbiAgICB9IGVsc2UgaWYgKGhhc0NoaWxkcmVuKGNoaWxkcmVuKSkge1xuICAgICAgICByZXR1cm4gUmVhY3QuQ2hpbGRyZW4ubWFwKGNoaWxkcmVuLCBjaGlsZCA9PiB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZFByb3BzID0gYXNzaWduKHt9LCBjaGlsZC5wcm9wcywgbWVzc2FnZVByb3BzKTtcbiAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KGNoaWxkLnR5cGUsIGNoaWxkUHJvcHMpO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59O1xuXG4vKipcbiAqIEN1c3RvbSBSZWFjdCBjb21wb25lbnQgcHJvdmlkZWQgYnkgRnJvc21vIChKb29uYSBPamFwYWxvKVxuICovXG5jb25zdCBfcmVuZGVyU3VjY2VzcyA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgICAgY2hpbGRyZW4sXG4gICAgICAgIGNvbXBvbmVudCxcbiAgICAgICAgZGVmYXVsdENvbXBvbmVudCxcbiAgICAgICAgbW9kaWZpY2F0aW9uQ29udGV4dCxcbiAgICB9ID0gcHJvcHM7XG5cbiAgICBjb25zdCBtZXNzYWdlUHJvcHMgPSBidWlsZE1lc3NhZ2VQcm9wcyhtb2RpZmljYXRpb25Db250ZXh0KTtcbiAgICBjb25zdCBvdXRwdXRDb21wb25lbnQgPSBjcmVhdGVSZWFjdENvbXBvbmVudChjb21wb25lbnQsIGNoaWxkcmVuLCBtZXNzYWdlUHJvcHMpO1xuXG4gICAgLy8gRGlzcGxheSB0cmFja2luZ1xuICAgIGlmICghb3V0cHV0Q29tcG9uZW50KSB7XG4gICAgICAgIC8vIFNob3cgZGVmYXVsdENvbXBvbmVudFxuICAgICAgICByZXR1cm4gX2NyZWF0ZVJlYWN0RWxlbWVudChkZWZhdWx0Q29tcG9uZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBtb2RpZmljYXRpb25Db250ZXh0LnNldERpc3BsYXllZCgpO1xuICAgICAgICByZXR1cm4gb3V0cHV0Q29tcG9uZW50O1xuICAgIH1cbn07XG5cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKHByb3BzKSB7XG4gICAgY29uc3Qge1xuICAgICAgICBkZWZhdWx0Q29tcG9uZW50LFxuICAgICAgICBtb2RpZmljYXRpb25Db250ZXh0XG4gICAgfSA9IHByb3BzO1xuXG4gICAgaWYgKG1vZGlmaWNhdGlvbkNvbnRleHQgIT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIF9yZW5kZXJTdWNjZXNzKHByb3BzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gX2NyZWF0ZVJlYWN0RWxlbWVudChkZWZhdWx0Q29tcG9uZW50KTtcbn07XG4iLCJpbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuXG5jb25zdCBNb2RpZmljYXRpb25Db250ZXh0UHJvcFR5cGVzID0ge1xuICAgIHZhcmlhdGlvbjogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICAgIHBhcmFtczogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGNvbnRlbnQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBzZXREaXNwbGF5ZWQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgc2V0Q2xpY2tlZDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBzZXRUcnVlRGlzcGxheWVkOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHNldFRyYWNrYWJsZUVsZW1lbnRzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHN0YXJ0VHJhY2tpbmc6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgZXJyb3I6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xlYXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWRcbn1cblxuY29uc3QgRnJvc21vUHJvcFR5cGVzID0ge1xuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbiAgICBjb21wb25lbnQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgICBQcm9wVHlwZXMubm9kZSxcbiAgICAgICAgUHJvcFR5cGVzLmVsZW1lbnRUeXBlLFxuICAgIF0pLFxuICAgIGRlZmF1bHRDb21wb25lbnQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgICBQcm9wVHlwZXMubm9kZSxcbiAgICAgICAgUHJvcFR5cGVzLmVsZW1lbnRUeXBlLFxuICAgIF0pLFxuXG4gICAgbW9kaWZpY2F0aW9uQ29udGV4dDogUHJvcFR5cGVzLmV4YWN0KE1vZGlmaWNhdGlvbkNvbnRleHRQcm9wVHlwZXMpLFxufTtcblxuZXhwb3J0IHtcbiAgICBGcm9zbW9Qcm9wVHlwZXMsXG59XG4iLCIvKiBnbG9iYWwgZnJvc21vICovXG5cbmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgQ2hpbGRDb21wb25lbnQgZnJvbSAnLi9DaGlsZENvbXBvbmVudCc7XG5cbmltcG9ydCB7IEZyb3Ntb1Byb3BUeXBlcyB9IGZyb20gXCIuL3NoYXBlc1wiO1xuXG5jb25zdCBGcm9zbW9Db21wb25lbnREZWZhdWx0UHJvcHMgPSB7XG4gICAgY2hpbGRyZW46IG51bGwsXG4gICAgY29tcG9uZW50OiBudWxsLFxuICAgIGRlZmF1bHRDb21wb25lbnQ6IG51bGwsXG4gICAgbW9kaWZpY2F0aW9uQ29udGV4dDogbnVsbCxcbn07XG5cbmNsYXNzIEZyb3Ntb1BsYWNlbWVudCBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIGlmICghcHJvcHMuaWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRnJvc21vUGxhY2VtZW50OiBcImlkXCIgcHJvcGVydHkgbWlzc2luZy4nLCBwcm9wcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBtb2RpZmljYXRpb25Db250ZXh0IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAobW9kaWZpY2F0aW9uQ29udGV4dCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gc3RhcnQgdHJhY2tpbmcgdGhlIG1lc3NhZ2VcbiAgICAgICAgICAgIG1vZGlmaWNhdGlvbkNvbnRleHQuc2V0VHJhY2thYmxlRWxlbWVudHModGhpcy5mcm9zbW9NZXNzYWdlKTtcbiAgICAgICAgICAgIG1vZGlmaWNhdGlvbkNvbnRleHQuc3RhcnRUcmFja2luZygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICAvLyBQYXNzIHN0YXRlIGFzIGltbXV0YWJsZSBwcm9wc1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gPENoaWxkQ29tcG9uZW50IHsuLi50aGlzLnByb3BzfSAvPjtcblxuICAgICAgICAvLyBXcmFwIGluIGZyYWdtZW50XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnVzZUZyYWdtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gPFJlYWN0LkZyYWdtZW50PntlbGVtZW50fTwvUmVhY3QuRnJhZ21lbnQ+O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gV3JhcCBpbnNpZGUgYSB0cmFja2FibGUgZGl2IGVsZW1lbnRcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICBkYXRhLWZyb3Ntby1lbGVtZW50aWQ9e3RoaXMucHJvcHMuaWR9XG4gICAgICAgICAgICAgICAgcmVmPXsgcmVmID0+IHsgdGhpcy5mcm9zbW9NZXNzYWdlID0gcmVmOyB9IH0+XG5cbiAgICAgICAgICAgICAgICAgICAge2VsZW1lbnR9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG5cbkZyb3Ntb1BsYWNlbWVudC5wcm9wVHlwZXMgPSBGcm9zbW9Qcm9wVHlwZXM7XG5Gcm9zbW9QbGFjZW1lbnQuZGVmYXVsdFByb3BzID0gRnJvc21vQ29tcG9uZW50RGVmYXVsdFByb3BzO1xuXG5leHBvcnQgZGVmYXVsdCBGcm9zbW9QbGFjZW1lbnQ7XG4iLCJpbXBvcnQgd2l0aE1lc3NhZ2UgZnJvbSAnLi9jb21wb25lbnRzL2hvY3Mvd2l0aE1lc3NhZ2UnO1xuaW1wb3J0IEZyb3Ntb1BsYWNlbWVudENvbXBvbmVudCBmcm9tICcuL2NvbXBvbmVudHMvZnJvc21vLXBsYWNlbWVudCc7XG5cbmNvbnN0IEZyb3Ntb1BsYWNlbWVudCA9IHdpdGhNZXNzYWdlKEZyb3Ntb1BsYWNlbWVudENvbXBvbmVudCk7XG5cbmV4cG9ydCB7XG4gICAgRnJvc21vUGxhY2VtZW50LFxufTtcbiJdLCJuYW1lcyI6WyJFUlJfU1BBX1VOQVZBTElBQkxFIiwiZXJyb3IiLCJtZXNzYWdlIiwid2luZG93IiwiZnJvc21vIiwic3BhIiwiY29uc29sZSIsIndhcm4iLCJsb2ciLCJET01fRVZFTlRfRlJPU01PX1NQQV9SRUFEWSIsIk1vZGlmaWNhdGlvblNlcnZpY2UiLCJpZCIsIm9uQ29tcGxldGUiLCJfaWQiLCJfZnVuYyIsIl9tb2RpZmljYXRpb25Db250ZXh0SGFuZGxlIiwiX2ZldGNoTW9kaWZpY2F0aW9ucyIsInRoaXMiLCJiaW5kIiwiYWRkRXZlbnRMaXN0ZW5lciIsImF0dGFjaEV2ZW50IiwibG9nZ2VyIiwicmVxdWVzdEJ5U2VsZWN0b3IiLCJ0aGVuIiwiY29udGV4dCIsIl90aGlzIiwiY2F0Y2giLCJjYW5jZWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZGV0YWNoRXZlbnQiLCJ3aXRoTWVzc2FnZSIsIldyYXBwZWRDb21wb25lbnQiLCJwcm9wcyIsInN0YXRlIiwiaXNSZWFkeSIsIm1vZGlmaWNhdGlvbkNvbnRleHQiLCJfbW9kaWZpY2F0aW9uQ29udGV4dFNlcnZpY2UiLCJzZXRTdGF0ZSIsIkNvbXBvbmVudCIsImZldGNoIiwiUmVhY3QiLCJfY3JlYXRlUmVhY3RFbGVtZW50IiwiY29tcG9uZW50IiwiY3JlYXRlRWxlbWVudCIsImhhc0NoaWxkcmVuIiwiY2hpbGRyZW4iLCJDaGlsZHJlbiIsImNvdW50IiwiYnVpbGRNZXNzYWdlUHJvcHMiLCJwYXJhbXMiLCJmcm9zbW9Nb2RpZmljYXRpb25Db250ZXh0IiwiY3JlYXRlUmVhY3RDb21wb25lbnQiLCJtZXNzYWdlUHJvcHMiLCJtYXAiLCJjaGlsZCIsImNoaWxkUHJvcHMiLCJhc3NpZ24iLCJ0eXBlIiwiX3JlbmRlclN1Y2Nlc3MiLCJkZWZhdWx0Q29tcG9uZW50Iiwib3V0cHV0Q29tcG9uZW50Iiwic2V0RGlzcGxheWVkIiwiTW9kaWZpY2F0aW9uQ29udGV4dFByb3BUeXBlcyIsInZhcmlhdGlvbiIsIlByb3BUeXBlcyIsIm51bWJlciIsImlzUmVxdWlyZWQiLCJvYmplY3QiLCJjb250ZW50Iiwic3RyaW5nIiwiZnVuYyIsInNldENsaWNrZWQiLCJzZXRUcnVlRGlzcGxheWVkIiwic2V0VHJhY2thYmxlRWxlbWVudHMiLCJzdGFydFRyYWNraW5nIiwiY2xlYXIiLCJGcm9zbW9Qcm9wVHlwZXMiLCJub2RlIiwib25lT2ZUeXBlIiwiZWxlbWVudFR5cGUiLCJleGFjdCIsIkZyb3Ntb0NvbXBvbmVudERlZmF1bHRQcm9wcyIsIkZyb3Ntb1BsYWNlbWVudCIsIkVycm9yIiwiZnJvc21vTWVzc2FnZSIsImVsZW1lbnQiLCJDaGlsZENvbXBvbmVudCIsInVzZUZyYWdtZW50IiwiRnJhZ21lbnQiLCJyZWYiLCJfdGhpczIiLCJwcm9wVHlwZXMiLCJkZWZhdWx0UHJvcHMiLCJGcm9zbW9QbGFjZW1lbnRDb21wb25lbnQiXSwibWFwcGluZ3MiOiJ5cEVBQ0EsSUFBTUEsb0JBQXNCLHlEQUU1QixTQUFTQyxNQUFNQyxHQUNOQyxRQUFXQSxPQUFPQyxRQUFXRCxPQUFPQyxPQUFPQyxNQUM1Q0MsUUFBUUMsS0FBS1AscUJBQ2JNLFFBQVFMLE1BQU1DLElBR2xCQyxPQUFPQyxPQUFPQyxJQUFJRyxJQUFJUCxNQUFNQyxFQUFTLHVCQUd6QyxXQUFlLENBQ1hELE1BQUFBLE9DWEVRLDJCQUE2QixtQkFHN0JDLGlEQUNZQyxJQUFBQSxHQUFJQyxJQUFBQSx3Q0FHVEMsSUFBTUYsT0FDTkcsTUFBUUYsR0FIQSxrQkFLUkcsMkJBQTZCLFVBQzdCQyxvQkFBc0JDLEtBQUtELG9CQUFvQkUsS0FBS0QsMkRBSXBEZCxTQUlEQSxPQUFPQyxRQUFVRCxPQUFPQyxPQUFPQyxTQUMxQlcsc0JBQ0ViLE9BQU9nQixpQkFDZGhCLE9BQU9nQixpQkFBaUJWLDJCQUE0QlEsS0FBS0QscUJBQ2xEYixPQUFPaUIsWUFDZGpCLE9BQU9pQixZQUFZWCwyQkFBNEJRLEtBQUtELHFCQUVwREssT0FBT3BCLE1BQU0sMkZBS1pjLDJCQUE2QlosT0FBT0MsT0FBT0MsSUFBSWlCLGtCQUFrQkwsS0FBS0osVUFDdEVFLDJCQUNBUSxLQUFLLFNBQUFDLFVBQVdDLEVBQUtYLE1BQU1VLEtBQzNCRSxNQUFNLFNBQUF6QixHQUNIb0IsT0FBT3BCLE1BQU1BLEdBQ2J3QixFQUFLWCxNQUFNLHlDQUtmRyxLQUFLRixrQ0FDQUEsMkJBQTJCWSxjQUMzQlosMkJBQTZCLE1BR2xDWixPQUFPeUIsb0JBQ1B6QixPQUFPeUIsb0JBQ0huQiwyQkFDQVEsS0FBS0QscUJBRUZiLE9BQU8wQixZQUNkMUIsT0FBTzBCLFlBQ0hwQiwyQkFDQVEsS0FBS0QscUJBR1RLLE9BQU9wQixNQUFNLGlDQUdaYSxNQUFRLHVCQzFER2dCLFlBQVlDLGlDQUVoQkMsd0dBQ0ZBLEtBRURDLE1BQVEsQ0FDVEMsU0FBUyxFQUNUQyxvQkFBcUIsUUFHcEJDLDRCQUE4QixJQUFJMUIsb0JBQW9CLENBQ3ZEQyxHQUFJcUIsRUFBTXJCLEdBQ1ZDLFdBQVksU0FBQ3VCLEtBQ0pFLFNBQVMsQ0FDVkYsb0JBQUFBLEVBQ0FELFNBQVMsNEJBZFJJLG1GQXFCUkYsNEJBQTRCVCwwREFJNUJTLDRCQUE0QkcsZ0RBSTVCdEIsS0FBS2dCLE1BQU1DLFFBSVRNLDZCQUFDVCxZQUNKSSxvQkFBcUJsQixLQUFLZ0IsTUFBTUUscUJBQzVCbEIsS0FBS2UsUUFMRixjQy9CdkIsSUFBTVMsb0JBQXNCLFNBQUFDLFVBQ3hCQSxFQUNNRixlQUFNRyxjQUFjRCxHQUNwQixNQUVKRSxZQUFjLFNBQUNDLFVBQWFBLEdBQTZDLEVBQWpDTCxlQUFNTSxTQUFTQyxNQUFNRixJQUM3REcsa0JBQW9CLFNBQUNiLDJCQUVKQSxFQUFYYyxRQUtKQywwQkFBMkJmLEtBSTdCZ0IscUJBQXVCLFNBQUNULEVBQVdHLEVBQVVPLFVBQzNDVixFQUNPRixlQUFNRyxjQUFjRCxFQUFXVSxHQUMvQlIsWUFBWUMsR0FDWkwsZUFBTU0sU0FBU08sSUFBSVIsRUFBVSxTQUFBUyxPQUMxQkMsRUFBYUMsT0FBTyxHQUFJRixFQUFNdEIsTUFBT29CLFVBQ3BDWixlQUFNRyxjQUFjVyxFQUFNRyxLQUFNRixLQUdwQyxNQU9URyxlQUFpQixTQUFDMUIsT0FFaEJhLEVBSUFiLEVBSkFhLFNBQ0FILEVBR0FWLEVBSEFVLFVBQ0FpQixFQUVBM0IsRUFGQTJCLGlCQUNBeEIsRUFDQUgsRUFEQUcsb0JBR0VpQixFQUFlSixrQkFBa0JiLEdBQ2pDeUIsRUFBa0JULHFCQUFxQlQsRUFBV0csRUFBVU8sVUFHN0RRLEdBSUR6QixFQUFvQjBCLGVBQ2JELEdBSEFuQixvQkFBb0JrQixJQVFuQyx3QkFBeUIzQixPQUVqQjJCLEVBRUEzQixFQUZBMkIsd0JBSXdCLE9BRnhCM0IsRUFEQUcsb0JBSU91QixlQUFlMUIsR0FHbkJTLG9CQUFvQmtCLE9DbkV6QkcsNkJBQStCLENBQ2pDQyxVQUFXQyxVQUFVQyxPQUFPQyxXQUM1QmpCLE9BQVFlLFVBQVVHLE9BQU9ELFdBQ3pCRSxRQUFTSixVQUFVSyxPQUFPSCxXQUMxQkwsYUFBY0csVUFBVU0sS0FBS0osV0FDN0JLLFdBQVlQLFVBQVVNLEtBQUtKLFdBQzNCTSxpQkFBa0JSLFVBQVVNLEtBQUtKLFdBQ2pDTyxxQkFBc0JULFVBQVVNLEtBQUtKLFdBQ3JDUSxjQUFlVixVQUFVTSxLQUFLSixXQUM5QmpFLE1BQU8rRCxVQUFVTSxLQUFLSixXQUN0QlMsTUFBT1gsVUFBVU0sS0FBS0osWUFHcEJVLGdCQUFrQixDQUNwQi9CLFNBQVVtQixVQUFVYSxLQUNwQm5DLFVBQVdzQixVQUFVYyxVQUFVLENBQzNCZCxVQUFVYSxLQUNWYixVQUFVZSxjQUVkcEIsaUJBQWtCSyxVQUFVYyxVQUFVLENBQ2xDZCxVQUFVYSxLQUNWYixVQUFVZSxjQUdkNUMsb0JBQXFCNkIsVUFBVWdCLE1BQU1sQiwrQkNuQm5DbUIsNEJBQThCLENBQ2hDcEMsU0FBVSxLQUNWSCxVQUFXLEtBQ1hpQixpQkFBa0IsS0FDbEJ4QixvQkFBcUIsTUFHbkIrQyx1Q0FDVWxELG1HQUNGQSxLQUVEQSxFQUFNckIsU0FDRCxJQUFJd0UsTUFBTSwwQ0FBMkNuRCwrQkFMekNNLCtFQVVkSCxFQUF3QmxCLEtBQUtlLE1BQTdCRyxvQkFDb0IsT0FBeEJBLElBRUFBLEVBQW9Cc0MscUJBQXFCeEQsS0FBS21FLGVBQzlDakQsRUFBb0J1Qyw2REFNbEJXLEVBQVU3Qyw2QkFBQzhDLGVBQW1CckUsS0FBS2UsY0FHckNmLEtBQUtlLE1BQU11RCxZQUNKL0MsNkJBQUNBLGVBQU1nRCxjQUFVSCxHQUt4QjdDLDREQUMyQnZCLEtBQUtlLE1BQU1yQixHQUNsQzhFLElBQU0sU0FBQUEsR0FBU0MsRUFBS04sY0FBZ0JLLElBRS9CSixZQU1yQkgsZ0JBQWdCUyxVQUFZZixnQkFDNUJNLGdCQUFnQlUsYUFBZVgsZ0NDbkR6QkMsa0JBQWtCcEQsWUFBWStEIn0=
