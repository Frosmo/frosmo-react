"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),assign=_interopDefault(require("object-assign")),PropTypes=_interopDefault(require("prop-types"));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}var ERR_SPA_UNAVALIABLE="frosmo.spa is not available, fallback to console.error";function error(e){window&&window.frosmo&&window.frosmo.spa||(console.warn(ERR_SPA_UNAVALIABLE),console.error(e)),window.frosmo.spa.log.error(e,"spa.react.placement")}var logger={error:error},DOM_EVENT_FROSMO_SPA_READY="frosmo.spa.ready",ModificationService=function(){function o(e){var t=e.id,n=e.onComplete;_classCallCheck(this,o);this._id=t,this._func=n||function(){},this._modificationContextHandle=null,this._fetchModifications=this._fetchModifications.bind(this)}return _createClass(o,[{key:"fetch",value:function(){window&&(window.frosmo&&window.frosmo.spa?this._fetchModifications():window.addEventListener?window.addEventListener(DOM_EVENT_FROSMO_SPA_READY,this._fetchModifications):window.attachEvent?window.attachEvent(DOM_EVENT_FROSMO_SPA_READY,this._fetchModifications):logger.error("Event cannot be attached"))}},{key:"_fetchModifications",value:function(){var t=this;this._modificationContextHandle=window.frosmo.spa.requestBySelector(this._id),this._modificationContextHandle.then(function(e){return t._func(e)}).catch(function(e){logger.error(e),t._func(null)})}},{key:"cancel",value:function(){this._modificationContextHandle&&(this._modificationContextHandle.cancel(),this._modificationContextHandle=null),window.removeEventListener?window.removeEventListener(DOM_EVENT_FROSMO_SPA_READY,this._fetchModifications):window.detachEvent?window.detachEvent(DOM_EVENT_FROSMO_SPA_READY,this._fetchModifications):logger.error("Event cannot be detached"),this._func=null}}]),o}();function withModification(t){return function(e){function n(e){var t;return _classCallCheck(this,n),t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e)),e.id||console&&console.warn&&console.warn('FrosmoPlacement: "id" property missing.',e),t.state={isReady:!1,modificationContext:null},t._modificationContextService=new ModificationService({id:e.id,onComplete:function(e){t.setState({modificationContext:e,isReady:!0})}}),t}return _inherits(n,React.Component),_createClass(n,[{key:"componentWillUnmount",value:function(){this._modificationContextService.cancel()}},{key:"componentDidMount",value:function(){this._modificationContextService.fetch()}},{key:"render",value:function(){return this.state.isReady?React__default.createElement(t,_extends({modificationContext:this.state.modificationContext},this.props)):this.props.defaultComponent?React__default.createElement(this.props.defaultComponent,this.props):null}}]),n}()}var _createReactElement=function(e){return e?React__default.createElement(e):null},hasChildren=function(e){return e&&0<React__default.Children.count(e)},buildMessageProps=function(e){return _objectSpread({},e.params,{frosmoModificationContext:e})},createReactComponent=function(e,t,n){return e?React__default.createElement(e,n):hasChildren(t)?React__default.Children.map(t,function(e){var t=assign({},e.props,n);return React__default.createElement(e.type,t)}):null},_renderSuccess=function(e){var t=e.children,n=e.component,o=e.defaultComponent,r=e.modificationContext,i=buildMessageProps(r),a=createReactComponent(n,t,i);return a?(r.setDisplayed(),a):_createReactElement(o)};function ChildComponent(e){var t=e.defaultComponent;return null!==e.modificationContext?_renderSuccess(e):_createReactElement(t)}var ModificationContextPropTypes={variation:PropTypes.number.isRequired,params:PropTypes.object.isRequired,content:PropTypes.string.isRequired,setDisplayed:PropTypes.func.isRequired,setClicked:PropTypes.func.isRequired,setTrueDisplayed:PropTypes.func.isRequired,setTrackableElements:PropTypes.func.isRequired,startTracking:PropTypes.func.isRequired,error:PropTypes.func.isRequired,clear:PropTypes.func.isRequired},FrosmoPropTypes={children:PropTypes.node,modificationContext:PropTypes.exact(ModificationContextPropTypes)},FrosmoComponentDefaultProps={children:null,component:null,defaultComponent:null,modificationContext:null},FrosmoPlacement=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){var e=this.props.modificationContext;null!==e&&(e.setTrackableElements(this.frosmoMessage),e.startTracking())}},{key:"render",value:function(){var t=this,e=React__default.createElement(ChildComponent,this.props);return this.props.useFragment?React__default.createElement(React__default.Fragment,null,e):React__default.createElement("div",{"data-frosmo-elementid":this.props.id,ref:function(e){t.frosmoMessage=e}},e)}}]),t}();FrosmoPlacement.propTypes=FrosmoPropTypes,FrosmoPlacement.defaultProps=FrosmoComponentDefaultProps;var FrosmoPlacement$1=withModification(FrosmoPlacement);exports.FrosmoPlacement=FrosmoPlacement$1;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgubWluLmpzIiwic291cmNlcyI6WyIuLi9zcmMvdXRpbHMvbG9nZ2VyLmpzIiwiLi4vc3JjL3NlcnZpY2VzL01vZGlmaWNhdGlvblNlcnZpY2UuanMiLCIuLi9zcmMvY29tcG9uZW50cy9ob2NzL3dpdGhNb2RpZmljYXRpb24uanMiLCIuLi9zcmMvY29tcG9uZW50cy9mcm9zbW8tcGxhY2VtZW50L0NoaWxkQ29tcG9uZW50LmpzIiwiLi4vc3JjL2NvbXBvbmVudHMvZnJvc21vLXBsYWNlbWVudC9zaGFwZXMuanMiLCIuLi9zcmMvY29tcG9uZW50cy9mcm9zbW8tcGxhY2VtZW50L0Zyb3Ntb1BsYWNlbWVudC5qcyIsIi4uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmNvbnN0IEVSUl9TUEFfVU5BVkFMSUFCTEUgPSAnZnJvc21vLnNwYSBpcyBub3QgYXZhaWxhYmxlLCBmYWxsYmFjayB0byBjb25zb2xlLmVycm9yJztcblxuZnVuY3Rpb24gZXJyb3IobWVzc2FnZSkge1xuICAgIGlmICghd2luZG93IHx8ICF3aW5kb3cuZnJvc21vIHx8ICF3aW5kb3cuZnJvc21vLnNwYSkge1xuICAgICAgICBjb25zb2xlLndhcm4oRVJSX1NQQV9VTkFWQUxJQUJMRSk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7XG4gICAgfVxuXG4gICAgd2luZG93LmZyb3Ntby5zcGEubG9nLmVycm9yKG1lc3NhZ2UsICdzcGEucmVhY3QucGxhY2VtZW50Jyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgICBlcnJvcixcbn1cbiIsImltcG9ydCBsb2dnZXIgZnJvbSBcIi4uL3V0aWxzL2xvZ2dlclwiO1xuXG5jb25zdCBET01fRVZFTlRfRlJPU01PX1NQQV9SRUFEWSA9ICdmcm9zbW8uc3BhLnJlYWR5JztcblxuXG5jbGFzcyBNb2RpZmljYXRpb25TZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3Rvcih7IGlkLCBvbkNvbXBsZXRlIH0pIHtcbiAgICAgICAgY29uc3Qgbm9vcCA9ICgpID0+IHt9O1xuXG4gICAgICAgIHRoaXMuX2lkID0gaWQ7XG4gICAgICAgIHRoaXMuX2Z1bmMgPSBvbkNvbXBsZXRlIHx8IG5vb3A7XG5cbiAgICAgICAgdGhpcy5fbW9kaWZpY2F0aW9uQ29udGV4dEhhbmRsZSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2ZldGNoTW9kaWZpY2F0aW9ucyA9IHRoaXMuX2ZldGNoTW9kaWZpY2F0aW9ucy5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIGZldGNoKCkge1xuICAgICAgICBpZiAoIXdpbmRvdykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdpbmRvdy5mcm9zbW8gJiYgd2luZG93LmZyb3Ntby5zcGEpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZldGNoTW9kaWZpY2F0aW9ucygpO1xuICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihET01fRVZFTlRfRlJPU01PX1NQQV9SRUFEWSwgdGhpcy5fZmV0Y2hNb2RpZmljYXRpb25zKTtcbiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuYXR0YWNoRXZlbnQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5hdHRhY2hFdmVudChET01fRVZFTlRfRlJPU01PX1NQQV9SRUFEWSwgdGhpcy5fZmV0Y2hNb2RpZmljYXRpb25zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRXZlbnQgY2Fubm90IGJlIGF0dGFjaGVkJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfZmV0Y2hNb2RpZmljYXRpb25zKCkge1xuICAgICAgICB0aGlzLl9tb2RpZmljYXRpb25Db250ZXh0SGFuZGxlID0gd2luZG93LmZyb3Ntby5zcGEucmVxdWVzdEJ5U2VsZWN0b3IodGhpcy5faWQpO1xuICAgICAgICB0aGlzLl9tb2RpZmljYXRpb25Db250ZXh0SGFuZGxlXG4gICAgICAgICAgICAudGhlbihjb250ZXh0ID0+IHRoaXMuX2Z1bmMoY29udGV4dCkpXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgdGhpcy5fZnVuYyhudWxsKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGNhbmNlbCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX21vZGlmaWNhdGlvbkNvbnRleHRIYW5kbGUpIHtcbiAgICAgICAgICAgIHRoaXMuX21vZGlmaWNhdGlvbkNvbnRleHRIYW5kbGUuY2FuY2VsKCk7XG4gICAgICAgICAgICB0aGlzLl9tb2RpZmljYXRpb25Db250ZXh0SGFuZGxlID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXG4gICAgICAgICAgICAgICAgRE9NX0VWRU5UX0ZST1NNT19TUEFfUkVBRFksXG4gICAgICAgICAgICAgICAgdGhpcy5fZmV0Y2hNb2RpZmljYXRpb25zXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5kZXRhY2hFdmVudCkge1xuICAgICAgICAgICAgd2luZG93LmRldGFjaEV2ZW50KFxuICAgICAgICAgICAgICAgIERPTV9FVkVOVF9GUk9TTU9fU1BBX1JFQURZLFxuICAgICAgICAgICAgICAgIHRoaXMuX2ZldGNoTW9kaWZpY2F0aW9uc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRXZlbnQgY2Fubm90IGJlIGRldGFjaGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9mdW5jID0gbnVsbDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE1vZGlmaWNhdGlvblNlcnZpY2U7XG4iLCJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IE1vZGlmaWNhdGlvblNlcnZpY2UgZnJvbSAnLi4vLi4vc2VydmljZXMvTW9kaWZpY2F0aW9uU2VydmljZSc7XG5cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gd2l0aE1vZGlmaWNhdGlvbihXcmFwcGVkQ29tcG9uZW50KSB7XG4gICAgcmV0dXJuIGNsYXNzIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICAgICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICAgICAgaWYgKCFwcm9wcy5pZCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUgJiYgY29uc29sZS53YXJuICYmIGNvbnNvbGUud2FybignRnJvc21vUGxhY2VtZW50OiBcImlkXCIgcHJvcGVydHkgbWlzc2luZy4nLCBwcm9wcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICAgICAgaXNSZWFkeTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbW9kaWZpY2F0aW9uQ29udGV4dDogbnVsbCxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMuX21vZGlmaWNhdGlvbkNvbnRleHRTZXJ2aWNlID0gbmV3IE1vZGlmaWNhdGlvblNlcnZpY2Uoe1xuICAgICAgICAgICAgICAgIGlkOiBwcm9wcy5pZCxcbiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlOiAobW9kaWZpY2F0aW9uQ29udGV4dCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWNhdGlvbkNvbnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1JlYWR5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICAgICAgdGhpcy5fbW9kaWZpY2F0aW9uQ29udGV4dFNlcnZpY2UuY2FuY2VsKCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgICAgIHRoaXMuX21vZGlmaWNhdGlvbkNvbnRleHRTZXJ2aWNlLmZldGNoKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZW5kZXIoKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuc3RhdGUuaXNSZWFkeSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BzLmRlZmF1bHRDb21wb25lbnRcbiAgICAgICAgICAgICAgICAgICAgPyBSZWFjdC5jcmVhdGVFbGVtZW50KHRoaXMucHJvcHMuZGVmYXVsdENvbXBvbmVudCwgdGhpcy5wcm9wcylcbiAgICAgICAgICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gPFdyYXBwZWRDb21wb25lbnRcbiAgICAgICAgICAgICAgICBtb2RpZmljYXRpb25Db250ZXh0PXt0aGlzLnN0YXRlLm1vZGlmaWNhdGlvbkNvbnRleHR9XG4gICAgICAgICAgICAgICAgey4uLnRoaXMucHJvcHMgfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgfVxuICAgIH1cbn1cbiIsImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgYXNzaWduIGZyb20gJ29iamVjdC1hc3NpZ24nO1xuXG5cbmNvbnN0IF9jcmVhdGVSZWFjdEVsZW1lbnQgPSBjb21wb25lbnQgPT5cbiAgICBjb21wb25lbnRcbiAgICAgICAgPyBSZWFjdC5jcmVhdGVFbGVtZW50KGNvbXBvbmVudClcbiAgICAgICAgOiBudWxsO1xuXG5jb25zdCBoYXNDaGlsZHJlbiA9IChjaGlsZHJlbikgPT4gY2hpbGRyZW4gJiYgUmVhY3QuQ2hpbGRyZW4uY291bnQoY2hpbGRyZW4pID4gMDtcbmNvbnN0IGJ1aWxkTWVzc2FnZVByb3BzID0gKG1vZGlmaWNhdGlvbkNvbnRleHQpID0+IHtcbiAgICAvLyBTZXQgdGVtcGxhdGVEZWZhdWx0cyBhcyBwcm9wc1xuICAgIGNvbnN0IHsgcGFyYW1zIH0gPSBtb2RpZmljYXRpb25Db250ZXh0O1xuXG4gICAgLy8gQnVpbGQgcHJvcHMgZm9yIG1vZGlmaWNhdGlvbiBjb21wb25lbnRcbiAgICByZXR1cm4ge1xuICAgICAgICAuLi5wYXJhbXMsXG4gICAgICAgIGZyb3Ntb01vZGlmaWNhdGlvbkNvbnRleHQ6IG1vZGlmaWNhdGlvbkNvbnRleHQsXG4gICAgfTtcbn07XG5cbmNvbnN0IGNyZWF0ZVJlYWN0Q29tcG9uZW50ID0gKGNvbXBvbmVudCwgY2hpbGRyZW4sIG1lc3NhZ2VQcm9wcykgPT4ge1xuICAgIGlmIChjb21wb25lbnQpIHtcbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50LCBtZXNzYWdlUHJvcHMpO1xuICAgIH0gZWxzZSBpZiAoaGFzQ2hpbGRyZW4oY2hpbGRyZW4pKSB7XG4gICAgICAgIHJldHVybiBSZWFjdC5DaGlsZHJlbi5tYXAoY2hpbGRyZW4sIGNoaWxkID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkUHJvcHMgPSBhc3NpZ24oe30sIGNoaWxkLnByb3BzLCBtZXNzYWdlUHJvcHMpO1xuICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoY2hpbGQudHlwZSwgY2hpbGRQcm9wcyk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn07XG5cbi8qKlxuICogQ3VzdG9tIFJlYWN0IGNvbXBvbmVudCBwcm92aWRlZCBieSBGcm9zbW8gKEpvb25hIE9qYXBhbG8pXG4gKi9cbmNvbnN0IF9yZW5kZXJTdWNjZXNzID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgICBjaGlsZHJlbixcbiAgICAgICAgY29tcG9uZW50LFxuICAgICAgICBkZWZhdWx0Q29tcG9uZW50LFxuICAgICAgICBtb2RpZmljYXRpb25Db250ZXh0LFxuICAgIH0gPSBwcm9wcztcblxuICAgIGNvbnN0IG1lc3NhZ2VQcm9wcyA9IGJ1aWxkTWVzc2FnZVByb3BzKG1vZGlmaWNhdGlvbkNvbnRleHQpO1xuICAgIGNvbnN0IG91dHB1dENvbXBvbmVudCA9IGNyZWF0ZVJlYWN0Q29tcG9uZW50KGNvbXBvbmVudCwgY2hpbGRyZW4sIG1lc3NhZ2VQcm9wcyk7XG5cbiAgICAvLyBEaXNwbGF5IHRyYWNraW5nXG4gICAgaWYgKCFvdXRwdXRDb21wb25lbnQpIHtcbiAgICAgICAgLy8gU2hvdyBkZWZhdWx0Q29tcG9uZW50XG4gICAgICAgIHJldHVybiBfY3JlYXRlUmVhY3RFbGVtZW50KGRlZmF1bHRDb21wb25lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG1vZGlmaWNhdGlvbkNvbnRleHQuc2V0RGlzcGxheWVkKCk7XG4gICAgICAgIHJldHVybiBvdXRwdXRDb21wb25lbnQ7XG4gICAgfVxufTtcblxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiAocHJvcHMpIHtcbiAgICBjb25zdCB7XG4gICAgICAgIGRlZmF1bHRDb21wb25lbnQsXG4gICAgICAgIG1vZGlmaWNhdGlvbkNvbnRleHRcbiAgICB9ID0gcHJvcHM7XG5cbiAgICBpZiAobW9kaWZpY2F0aW9uQ29udGV4dCAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gX3JlbmRlclN1Y2Nlc3MocHJvcHMpO1xuICAgIH1cblxuICAgIHJldHVybiBfY3JlYXRlUmVhY3RFbGVtZW50KGRlZmF1bHRDb21wb25lbnQpO1xufTtcbiIsImltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5jb25zdCBNb2RpZmljYXRpb25Db250ZXh0UHJvcFR5cGVzID0ge1xuICAgIHZhcmlhdGlvbjogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICAgIHBhcmFtczogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGNvbnRlbnQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBzZXREaXNwbGF5ZWQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgc2V0Q2xpY2tlZDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBzZXRUcnVlRGlzcGxheWVkOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHNldFRyYWNrYWJsZUVsZW1lbnRzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHN0YXJ0VHJhY2tpbmc6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgZXJyb3I6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2xlYXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWRcbn1cblxuY29uc3QgRnJvc21vUHJvcFR5cGVzID0ge1xuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbiAgICBtb2RpZmljYXRpb25Db250ZXh0OiBQcm9wVHlwZXMuZXhhY3QoTW9kaWZpY2F0aW9uQ29udGV4dFByb3BUeXBlcyksXG59O1xuXG5leHBvcnQge1xuICAgIEZyb3Ntb1Byb3BUeXBlcyxcbn1cbiIsIi8qIGdsb2JhbCBmcm9zbW8gKi9cblxuaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBDaGlsZENvbXBvbmVudCBmcm9tICcuL0NoaWxkQ29tcG9uZW50JztcblxuaW1wb3J0IHsgRnJvc21vUHJvcFR5cGVzIH0gZnJvbSBcIi4vc2hhcGVzXCI7XG5cbmNvbnN0IEZyb3Ntb0NvbXBvbmVudERlZmF1bHRQcm9wcyA9IHtcbiAgICBjaGlsZHJlbjogbnVsbCxcbiAgICBjb21wb25lbnQ6IG51bGwsXG4gICAgZGVmYXVsdENvbXBvbmVudDogbnVsbCxcbiAgICBtb2RpZmljYXRpb25Db250ZXh0OiBudWxsLFxufTtcblxuY2xhc3MgRnJvc21vUGxhY2VtZW50IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgbW9kaWZpY2F0aW9uQ29udGV4dCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKG1vZGlmaWNhdGlvbkNvbnRleHQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIHN0YXJ0IHRyYWNraW5nIHRoZSBtZXNzYWdlXG4gICAgICAgICAgICBtb2RpZmljYXRpb25Db250ZXh0LnNldFRyYWNrYWJsZUVsZW1lbnRzKHRoaXMuZnJvc21vTWVzc2FnZSk7XG4gICAgICAgICAgICBtb2RpZmljYXRpb25Db250ZXh0LnN0YXJ0VHJhY2tpbmcoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgLy8gUGFzcyBzdGF0ZSBhcyBpbW11dGFibGUgcHJvcHNcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IDxDaGlsZENvbXBvbmVudCB7Li4udGhpcy5wcm9wc30gLz47XG5cbiAgICAgICAgLy8gV3JhcCBpbiBmcmFnbWVudFxuICAgICAgICBpZiAodGhpcy5wcm9wcy51c2VGcmFnbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIDxSZWFjdC5GcmFnbWVudD57ZWxlbWVudH08L1JlYWN0LkZyYWdtZW50PjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdyYXAgaW5zaWRlIGEgdHJhY2thYmxlIGRpdiBlbGVtZW50XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgZGF0YS1mcm9zbW8tZWxlbWVudGlkPXt0aGlzLnByb3BzLmlkfVxuICAgICAgICAgICAgICAgIHJlZj17IHJlZiA9PiB7IHRoaXMuZnJvc21vTWVzc2FnZSA9IHJlZjsgfSB9PlxuXG4gICAgICAgICAgICAgICAgICAgIHtlbGVtZW50fVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfVxufVxuXG5Gcm9zbW9QbGFjZW1lbnQucHJvcFR5cGVzID0gRnJvc21vUHJvcFR5cGVzO1xuRnJvc21vUGxhY2VtZW50LmRlZmF1bHRQcm9wcyA9IEZyb3Ntb0NvbXBvbmVudERlZmF1bHRQcm9wcztcblxuZXhwb3J0IGRlZmF1bHQgRnJvc21vUGxhY2VtZW50O1xuIiwiaW1wb3J0IHdpdGhNb2RpZmljYXRpb24gZnJvbSAnLi9jb21wb25lbnRzL2hvY3Mvd2l0aE1vZGlmaWNhdGlvbic7XG5pbXBvcnQgRnJvc21vUGxhY2VtZW50Q29tcG9uZW50IGZyb20gJy4vY29tcG9uZW50cy9mcm9zbW8tcGxhY2VtZW50JztcblxuY29uc3QgRnJvc21vUGxhY2VtZW50ID0gd2l0aE1vZGlmaWNhdGlvbihGcm9zbW9QbGFjZW1lbnRDb21wb25lbnQpO1xuXG5leHBvcnQge1xuICAgIEZyb3Ntb1BsYWNlbWVudCxcbn07XG4iXSwibmFtZXMiOlsiRVJSX1NQQV9VTkFWQUxJQUJMRSIsImVycm9yIiwibWVzc2FnZSIsIndpbmRvdyIsImZyb3NtbyIsInNwYSIsImNvbnNvbGUiLCJ3YXJuIiwibG9nIiwiRE9NX0VWRU5UX0ZST1NNT19TUEFfUkVBRFkiLCJNb2RpZmljYXRpb25TZXJ2aWNlIiwiaWQiLCJvbkNvbXBsZXRlIiwiX2lkIiwiX2Z1bmMiLCJfbW9kaWZpY2F0aW9uQ29udGV4dEhhbmRsZSIsIl9mZXRjaE1vZGlmaWNhdGlvbnMiLCJ0aGlzIiwiYmluZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhdHRhY2hFdmVudCIsImxvZ2dlciIsInJlcXVlc3RCeVNlbGVjdG9yIiwidGhlbiIsImNvbnRleHQiLCJfdGhpcyIsImNhdGNoIiwiY2FuY2VsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImRldGFjaEV2ZW50Iiwid2l0aE1vZGlmaWNhdGlvbiIsIldyYXBwZWRDb21wb25lbnQiLCJwcm9wcyIsInN0YXRlIiwiaXNSZWFkeSIsIm1vZGlmaWNhdGlvbkNvbnRleHQiLCJfbW9kaWZpY2F0aW9uQ29udGV4dFNlcnZpY2UiLCJzZXRTdGF0ZSIsIkNvbXBvbmVudCIsImZldGNoIiwiUmVhY3QiLCJkZWZhdWx0Q29tcG9uZW50IiwiY3JlYXRlRWxlbWVudCIsIl9jcmVhdGVSZWFjdEVsZW1lbnQiLCJjb21wb25lbnQiLCJoYXNDaGlsZHJlbiIsImNoaWxkcmVuIiwiQ2hpbGRyZW4iLCJjb3VudCIsImJ1aWxkTWVzc2FnZVByb3BzIiwicGFyYW1zIiwiZnJvc21vTW9kaWZpY2F0aW9uQ29udGV4dCIsImNyZWF0ZVJlYWN0Q29tcG9uZW50IiwibWVzc2FnZVByb3BzIiwibWFwIiwiY2hpbGQiLCJjaGlsZFByb3BzIiwiYXNzaWduIiwidHlwZSIsIl9yZW5kZXJTdWNjZXNzIiwib3V0cHV0Q29tcG9uZW50Iiwic2V0RGlzcGxheWVkIiwiTW9kaWZpY2F0aW9uQ29udGV4dFByb3BUeXBlcyIsInZhcmlhdGlvbiIsIlByb3BUeXBlcyIsIm51bWJlciIsImlzUmVxdWlyZWQiLCJvYmplY3QiLCJjb250ZW50Iiwic3RyaW5nIiwiZnVuYyIsInNldENsaWNrZWQiLCJzZXRUcnVlRGlzcGxheWVkIiwic2V0VHJhY2thYmxlRWxlbWVudHMiLCJzdGFydFRyYWNraW5nIiwiY2xlYXIiLCJGcm9zbW9Qcm9wVHlwZXMiLCJub2RlIiwiZXhhY3QiLCJGcm9zbW9Db21wb25lbnREZWZhdWx0UHJvcHMiLCJGcm9zbW9QbGFjZW1lbnQiLCJmcm9zbW9NZXNzYWdlIiwiZWxlbWVudCIsIkNoaWxkQ29tcG9uZW50IiwidXNlRnJhZ21lbnQiLCJGcmFnbWVudCIsInJlZiIsInByb3BUeXBlcyIsImRlZmF1bHRQcm9wcyIsIkZyb3Ntb1BsYWNlbWVudENvbXBvbmVudCJdLCJtYXBwaW5ncyI6InlwRUFDQSxJQUFNQSxvQkFBc0IseURBRTVCLFNBQVNDLE1BQU1DLEdBQ05DLFFBQVdBLE9BQU9DLFFBQVdELE9BQU9DLE9B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
