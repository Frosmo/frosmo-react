"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react")),assign=_interopDefault(require("object-assign")),PropTypes=_interopDefault(require("prop-types"));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,o[e])})}return t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}var pick=function(o,e){return e.reduce(function(e,t){return o[t]&&(e[t]=o[t]),e},{})},pickState=["status","component","loadComponent","errorComponent","message","positionData"],STATUS_LOADING="loading",STATUS_SUCCESS="success",STATUS_ERROR="error",STATUS_NOTFOUND="notfound",DOM_EVENT_FROSMO_SPA_READY="frosmo.spa.ready",ChildComponentPropTypes={children:PropTypes.node,component:PropTypes.node,status:PropTypes.oneOf([STATUS_LOADING,STATUS_SUCCESS,STATUS_NOTFOUND,STATUS_ERROR]),loadComponent:PropTypes.node,errorComponent:PropTypes.node,message:PropTypes.shape({template:PropTypes.shape({defaults:PropTypes.any})}),positionData:PropTypes.shape({message:PropTypes.object,rules:PropTypes.array})},ChildComponentDefaultProps={children:null,component:null,status:"",loadComponent:null,errorComponent:null,message:void 0,positionData:void 0},ChildComponent=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.children,o=e.status,n=e.component,r=e.loadComponent,s=e.errorComponent,a=e.message,i=e.positionData,p=function(e){return e?React.createElement(e):null};switch(o){case STATUS_NOTFOUND:case STATUS_LOADING:return p(r);case STATUS_SUCCESS:var c=_objectSpread({},a.template?JSON.parse(a.template.defaults):{},{frosmoMessage:a,frosmoPositionData:i}),l=t&&0<React.Children.count(t),u=n?React.createElement(n,c):l?React.Children.map(t,function(e){var t=assign({},e.props,c);return React.createElement(e.type,t)}):null;if(u)i.getMessageInstance().setDisplayed();return u||p(r);case STATUS_ERROR:return s?React.createElement(s):null;default:return console.error("[FrosmoPlacement] :: invalid status",o),null}}}]),t}();ChildComponent.propTypes=ChildComponentPropTypes,ChildComponent.defaultProps=ChildComponentDefaultProps;var FrosmoPlacement=function(e){function o(e){var t;if(_classCallCheck(this,o),(t=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this,e))).onFrosmoSpaReady.bind(_assertThisInitialized(t)),t.state={status:STATUS_LOADING,message:null,positionData:null,fetchPromise:null},!e.id)throw new Error('FrosmoPlacement: "id" property missing.',e);return t}return _inherits(o,React.Component),_createClass(o,[{key:"onFrosmoSpaReady",value:function(){var t=this;window.removeEventListener(DOM_EVENT_FROSMO_SPA_READY,this.onFrosmoSpaReady);var e=this.props.id,o=frosmo.spa.requestBySelector(e).then(function(e){e.positionData.message||t.setState({fetchPromise:null,status:STATUS_NOTFOUND}),t.setState({fetchPromise:null,status:STATUS_SUCCESS,message:e.positionData.message,positionData:e.positionData,clearMessage:e.clear})}).catch(function(e){t.setState({status:STATUS_ERROR}),frosmo.spa.log.error(e,"spa.react.placement")});this.setState({fetchPromise:o})}},{key:"componentWillUnmount",value:function(){window.removeEventListener(DOM_EVENT_FROSMO_SPA_READY,this.onFrosmoSpaReady),this.state.fetchPromise&&this.state.fetchPromise.cancel(),this.state.clearMessage&&this.state.clearMessage()}},{key:"componentDidMount",value:function(){window.frosmo&&window.frosmo.spa?this.onFrosmoSpaReady():window.addEventListener(DOM_EVENT_FROSMO_SPA_READY,this.onFrosmoSpaReady)}},{key:"componentDidUpdate",value:function(){if(this.state.status===STATUS_SUCCESS){var e=this.refs.frosmomessage,t=this.state.positionData.getMessageInstance();if(!e||!t)return;t.setTrackableElements(e),t.startTracking()}}},{key:"render",value:function(){var e=pick(this.state,pickState),t=React.createElement(ChildComponent,_extends({},this.props,e));return this.props.useFragment?React.createElement(React.Fragment,null,t):React.createElement("div",{"data-frosmo-elementid":this.props.id,ref:"frosmomessage"},t)}}]),o}();exports.FrosmoPlacement=FrosmoPlacement;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgubWluLmpzIiwic291cmNlcyI6WyIuLi9zcmMvdXRpbHMvaW5kZXguanMiLCIuLi9zcmMvY29tcG9uZW50cy9mcm9zbW8tcGxhY2VtZW50L0Zyb3Ntb1BsYWNlbWVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZSBuZXcgb2JqZWN0IHdpdGgga2V5cyBhbmQgdmFsdWVzIHBpY2tlZCBmcm9tIG9iai5cbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogXG4gKiBAcGFyYW0ge0FycmF5LjxTdHJpbmc+fSBrZXlzXG4gKiBAcmV0dXJucyB7T2JqZWN0fVxuICovXG5jb25zdCBwaWNrID0gKG9iaiwga2V5cykgPT4ga2V5cy5yZWR1Y2UoKGFjYywga2V5KSA9PiB7XG4gICAgaWYgKG9ialtrZXldKSB7XG4gICAgICAgIGFjY1trZXldID0gb2JqW2tleV07XG4gICAgfVxuICAgIHJldHVybiBhY2M7XG59LCB7fSk7XG5cbmV4cG9ydCB7XG4gICAgcGljayxcbn1cbiIsIi8qIGdsb2JhbCBmcm9zbW8gKi9cbi8qIGVzbGludC1kaXNhYmxlIG5vLW5lc3RlZC10ZXJuYXJ5ICovXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IGFzc2lnbiBmcm9tICdvYmplY3QtYXNzaWduJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5cbmltcG9ydCB7IHBpY2sgfSBmcm9tICcuLi8uLi91dGlscyc7XG5cbi8vIHByb3BzIHBhc3NlZCBjaGlsZCBjb21wb25lbnQgXG5jb25zdCBwaWNrU3RhdGUgPSBbXCJzdGF0dXNcIiwgXCJjb21wb25lbnRcIiwgXCJsb2FkQ29tcG9uZW50XCIsIFwiZXJyb3JDb21wb25lbnRcIiwgXCJtZXNzYWdlXCIsIFwicG9zaXRpb25EYXRhXCJdO1xuXG5jb25zdCBTVEFUVVNfTE9BRElORyA9ICdsb2FkaW5nJztcbmNvbnN0IFNUQVRVU19TVUNDRVNTID0gJ3N1Y2Nlc3MnO1xuY29uc3QgU1RBVFVTX0VSUk9SID0gJ2Vycm9yJztcbmNvbnN0IFNUQVRVU19OT1RGT1VORCA9ICdub3Rmb3VuZCc7XG5jb25zdCBET01fRVZFTlRfRlJPU01PX1NQQV9SRUFEWSA9ICdmcm9zbW8uc3BhLnJlYWR5J1xuXG5jb25zdCBDaGlsZENvbXBvbmVudFByb3BUeXBlcyA9IHtcbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUsXG4gICAgY29tcG9uZW50OiBQcm9wVHlwZXMubm9kZSxcbiAgICBzdGF0dXM6IFByb3BUeXBlcy5vbmVPZihbXG4gICAgICBTVEFUVVNfTE9BRElORyxcbiAgICAgIFNUQVRVU19TVUNDRVNTLFxuICAgICAgU1RBVFVTX05PVEZPVU5ELFxuICAgICAgU1RBVFVTX0VSUk9SLFxuICAgIF0pLFxuICAgIGxvYWRDb21wb25lbnQ6IFByb3BUeXBlcy5ub2RlLFxuICAgIGVycm9yQ29tcG9uZW50OiBQcm9wVHlwZXMubm9kZSxcbiAgICBtZXNzYWdlOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgdGVtcGxhdGU6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgIGRlZmF1bHRzOiBQcm9wVHlwZXMuYW55LFxuICAgICAgfSksXG4gICAgfSksXG4gICAgcG9zaXRpb25EYXRhOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgbWVzc2FnZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICAgIHJ1bGVzOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgfSksXG4gIH07XG5cbmNvbnN0IENoaWxkQ29tcG9uZW50RGVmYXVsdFByb3BzID0ge1xuICAgIGNoaWxkcmVuOiBudWxsLFxuICAgIGNvbXBvbmVudDogbnVsbCxcbiAgICBzdGF0dXM6ICcnLFxuICAgIGxvYWRDb21wb25lbnQ6IG51bGwsXG4gICAgZXJyb3JDb21wb25lbnQ6IG51bGwsXG4gICAgbWVzc2FnZTogdW5kZWZpbmVkLFxuICAgIHBvc2l0aW9uRGF0YTogdW5kZWZpbmVkLFxufTtcblxuXG4vKipcbiAqIEN1c3RvbSBSZWFjdCBjb21wb25lbnQgcHJvdmlkZWQgYnkgRnJvc21vIChKb29uYSBPamFwYWxvKVxuICovXG5jbGFzcyBDaGlsZENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgcmVuZGVyICgpIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgY2hpbGRyZW4sXG4gICAgICAgICAgICBzdGF0dXMsXG4gICAgICAgICAgICBjb21wb25lbnQsXG4gICAgICAgICAgICBsb2FkQ29tcG9uZW50LFxuICAgICAgICAgICAgZXJyb3JDb21wb25lbnQsXG4gICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgcG9zaXRpb25EYXRhLFxuICAgICAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgICAgICBjb25zdCBidWlsZExvYWRFbGVtZW50ID0gbG9hZENvbXBvbmVudCA9PlxuICAgICAgICAgICAgbG9hZENvbXBvbmVudFxuICAgICAgICAgICAgICAgID8gUmVhY3QuY3JlYXRlRWxlbWVudChsb2FkQ29tcG9uZW50KVxuICAgICAgICAgICAgICAgIDogbnVsbDtcblxuICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBTVEFUVVNfTk9URk9VTkQ6XG4gICAgICAgICAgICBjYXNlIFNUQVRVU19MT0FESU5HOlxuICAgICAgICAgICAgICAgIHJldHVybiBidWlsZExvYWRFbGVtZW50KGxvYWRDb21wb25lbnQpO1xuXG4gICAgICAgICAgICBjYXNlIFNUQVRVU19TVUNDRVNTOlxuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlRGVmYXVsdHMgPSBtZXNzYWdlLnRlbXBsYXRlXG4gICAgICAgICAgICAgICAgICAgID8gSlNPTi5wYXJzZShtZXNzYWdlLnRlbXBsYXRlLmRlZmF1bHRzKVxuICAgICAgICAgICAgICAgICAgICA6IHt9O1xuXG4gICAgICAgICAgICAgICAgLy8gYnVpbGQgcHJvcHMgZm9yIG1vZGlmaWNhdGlvbiBjb21wb25lbnRcbiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlUHJvcHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRlbXBsYXRlRGVmYXVsdHMsXG4gICAgICAgICAgICAgICAgICAgIGZyb3Ntb01lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIGZyb3Ntb1Bvc2l0aW9uRGF0YTogcG9zaXRpb25EYXRhLFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvLyBzZXQgdGVtcGxhdGVEZWZhdWx0cyBhcyBwcm9wc1xuICAgICAgICAgICAgICAgIGNvbnN0IGhhc0NoaWxkcmVuID0gY2hpbGRyZW4gJiYgUmVhY3QuQ2hpbGRyZW4uY291bnQoY2hpbGRyZW4pID4gMDtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dENvbXBvbmVudCA9IGNvbXBvbmVudFxuICAgICAgICAgICAgICAgICAgICAgPyBSZWFjdC5jcmVhdGVFbGVtZW50KGNvbXBvbmVudCwgbWVzc2FnZVByb3BzKVxuICAgICAgICAgICAgICAgICAgICAgOiBoYXNDaGlsZHJlblxuICAgICAgICAgICAgICAgICAgICAgICAgPyBSZWFjdC5DaGlsZHJlbi5tYXAoY2hpbGRyZW4sIGNoaWxkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wcyA9IGFzc2lnbih7fSwgY2hpbGQucHJvcHMsIG1lc3NhZ2VQcm9wcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoY2hpbGQudHlwZSwgcHJvcHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogbnVsbDtcblxuICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgdHJhY2tpbmdcbiAgICAgICAgICAgICAgICBpZiAob3V0cHV0Q29tcG9uZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pID0gcG9zaXRpb25EYXRhLmdldE1lc3NhZ2VJbnN0YW5jZSgpO1xuICAgICAgICAgICAgICAgICAgICBtaS5zZXREaXNwbGF5ZWQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBzaG93IGxvYWRDb21wb25lbnQgYXMgZmFsbGJhY2tcbiAgICAgICAgICAgICAgICBpZiAoIW91dHB1dENvbXBvbmVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRMb2FkRWxlbWVudChsb2FkQ29tcG9uZW50KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gb3V0cHV0Q29tcG9uZW50O1xuXG4gICAgICAgICAgICBjYXNlIFNUQVRVU19FUlJPUjpcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3JDb21wb25lbnRcbiAgICAgICAgICAgICAgICAgICAgPyBSZWFjdC5jcmVhdGVFbGVtZW50KGVycm9yQ29tcG9uZW50KVxuICAgICAgICAgICAgICAgICAgICA6IG51bGw7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW0Zyb3Ntb1BsYWNlbWVudF0gOjogaW52YWxpZCBzdGF0dXMnLCBzdGF0dXMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5DaGlsZENvbXBvbmVudC5wcm9wVHlwZXMgPSBDaGlsZENvbXBvbmVudFByb3BUeXBlcztcbkNoaWxkQ29tcG9uZW50LmRlZmF1bHRQcm9wcyA9IENoaWxkQ29tcG9uZW50RGVmYXVsdFByb3BzO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGcm9zbW9QbGFjZW1lbnQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICAvLyBiaW5kIHRvIGNsYXNzXG4gICAgICAgIHRoaXMub25Gcm9zbW9TcGFSZWFkeS5iaW5kKHRoaXMpXG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHN0YXR1czogU1RBVFVTX0xPQURJTkcsXG4gICAgICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgcG9zaXRpb25EYXRhOiBudWxsLFxuICAgICAgICAgICAgZmV0Y2hQcm9taXNlOiBudWxsLFxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICghcHJvcHMuaWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRnJvc21vUGxhY2VtZW50OiBcImlkXCIgcHJvcGVydHkgbWlzc2luZy4nLCBwcm9wcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkZyb3Ntb1NwYVJlYWR5KCkge1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihET01fRVZFTlRfRlJPU01PX1NQQV9SRUFEWSwgdGhpcy5vbkZyb3Ntb1NwYVJlYWR5KTtcblxuICAgICAgICBjb25zdCBpZCA9IHRoaXMucHJvcHMuaWQ7XG5cbiAgICAgICAgLy8gc3RhcnQgbG9hZGluZ1xuICAgICAgICBjb25zdCBmZXRjaFByb21pc2UgPSBmcm9zbW8uc3BhLnJlcXVlc3RCeVNlbGVjdG9yKGlkKVxuICAgICAgICAgICAgLnRoZW4obWVzc2FnZUhhbmRsZSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gbm8gZGlzcGxheSBmcm9tIHNlcnZlci1zaWRlXG4gICAgICAgICAgICAgICAgaWYgKCFtZXNzYWdlSGFuZGxlLnBvc2l0aW9uRGF0YS5tZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hQcm9taXNlOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBTVEFUVVNfTk9URk9VTkQsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICBmZXRjaFByb21pc2U6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogU1RBVFVTX1NVQ0NFU1MsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VIYW5kbGUucG9zaXRpb25EYXRhLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uRGF0YTogbWVzc2FnZUhhbmRsZS5wb3NpdGlvbkRhdGEsXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyTWVzc2FnZTogbWVzc2FnZUhhbmRsZS5jbGVhcixcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFNUQVRVU19FUlJPUlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGZyb3Ntby5zcGEubG9nLmVycm9yKGVycm9yLCAnc3BhLnJlYWN0LnBsYWNlbWVudCcpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7ZmV0Y2hQcm9taXNlfSk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIC8vIGNsZWFyIHBsdWdnaW5nLCBpZiBleGlzdFxuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihET01fRVZFTlRfRlJPU01PX1NQQV9SRUFEWSwgdGhpcy5vbkZyb3Ntb1NwYVJlYWR5KTtcblxuICAgICAgICAvLyBjYW5jZWwgb25nb2luZyBmZXRjaCByZXF1ZXN0XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmZldGNoUHJvbWlzZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5mZXRjaFByb21pc2UuY2FuY2VsKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjbGVhciBtZXNzYWdlIGlmIHdhcyBsb2FkZWRcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuY2xlYXJNZXNzYWdlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLmNsZWFyTWVzc2FnZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIC8vIHN0YXJ0IHBsdWdnaW5nXG4gICAgICAgIGlmICh3aW5kb3cuZnJvc21vICYmIHdpbmRvdy5mcm9zbW8uc3BhKSB7XG4gICAgICAgICAgICB0aGlzLm9uRnJvc21vU3BhUmVhZHkoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKERPTV9FVkVOVF9GUk9TTU9fU1BBX1JFQURZLCB0aGlzLm9uRnJvc21vU3BhUmVhZHkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5zdGF0dXMgPT09IFNUQVRVU19TVUNDRVNTKSB7XG4gICAgICAgICAgICBjb25zdCBlbCA9IHRoaXMucmVmcy5mcm9zbW9tZXNzYWdlO1xuICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLnN0YXRlLnBvc2l0aW9uRGF0YS5nZXRNZXNzYWdlSW5zdGFuY2UoKTtcblxuICAgICAgICAgICAgLy8gVE9ETzogcHJvcGVyIGVycm9yIGhhbmRsaW5nIG1vZGVsLi4uXG4gICAgICAgICAgICBpZiAoIWVsIHx8ICFpbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc3RhcnQgdHJhY2tpbmcgdGhlIG1lc3NhZ2VcbiAgICAgICAgICAgIGluc3RhbmNlLnNldFRyYWNrYWJsZUVsZW1lbnRzKGVsKTtcbiAgICAgICAgICAgIGluc3RhbmNlLnN0YXJ0VHJhY2tpbmcoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgLy8gcGFzcyBzdGF0ZSBhcyBpbW11dGFibGUgcHJvcHNcbiAgICAgICAgY29uc3Qgc3RhdGVDbG9uZSA9IHBpY2sodGhpcy5zdGF0ZSwgcGlja1N0YXRlKTtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IDxDaGlsZENvbXBvbmVudCB7Li4udGhpcy5wcm9wc30gey4uLnN0YXRlQ2xvbmV9Lz47XG5cbiAgICAgICAgLy8gd3JhcCBpbiBmcmFnbWVudFxuICAgICAgICBpZiAodGhpcy5wcm9wcy51c2VGcmFnbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIDxSZWFjdC5GcmFnbWVudD57ZWxlbWVudH08L1JlYWN0LkZyYWdtZW50PjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHdyYXAgaW5zaWRlIGEgdHJhY2thYmxlIGRpdiBlbGVtZW50XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGRhdGEtZnJvc21vLWVsZW1lbnRpZD17dGhpcy5wcm9wcy5pZH0gcmVmPVwiZnJvc21vbWVzc2FnZVwiPntlbGVtZW50fTwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJwaWNrIiwib2JqIiwia2V5cyIsInJlZHVjZSIsImFjYyIsImtleSIsInBpY2tTdGF0ZSIsIlNUQVRVU19MT0FESU5HIiwiU1RBVFVTX1NVQ0NFU1MiLCJTVEFUVVNfRVJST1IiLCJTVEFUVVNfTk9URk9VTkQiLCJET01fRVZFTlRfRlJPU01PX1NQQV9SRUFEWSIsIkNoaWxkQ29tcG9uZW50UHJvcFR5cGVzIiwiY2hpbGRyZW4iLCJQcm9wVHlwZXMiLCJub2RlIiwiY29tcG9uZW50Iiwic3RhdHVzIiwib25lT2YiLCJsb2FkQ29tcG9uZW50IiwiZXJyb3JDb21wb25lbnQiLCJtZXNzYWdlIiwic2hhcGUiLCJ0ZW1wbGF0ZSIsImRlZmF1bHRzIiwiYW55IiwicG9zaXRpb25EYXRhIiwib2JqZWN0IiwicnVsZXMiLCJhcnJheSIsIkNoaWxkQ29tcG9uZW50RGVmYXVsdFByb3BzIiwidW5kZWZpbmVkIiwiQ2hpbGRDb21wb25lbnQiLCJSZWFjdCIsIkNvbXBvbmVudCIsInRoaXMiLCJwcm9wcyIsImJ1aWxkTG9hZEVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwibWVzc2FnZVByb3BzIiwiSlNPTiIsInBhcnNlIiwiZnJvc21vTWVzc2FnZSIsImZyb3Ntb1Bvc2l0aW9uRGF0YSIsImhhc0NoaWxkcmVuIiwiQ2hpbGRyZW4iLCJjb3VudCIsIm91dHB1dENvbXBvbmVudCIsIm1hcCIsImNoaWxkIiwiYXNzaWduIiwidHlwZSIsImdldE1lc3NhZ2VJbnN0YW5jZSIsInNldERpc3BsYXllZCIsImNvbnNvbGUiLCJlcnJvciIsInByb3BUeXBlcyIsImRlZmF1bHRQcm9wcyIsIkZyb3Ntb1BsYWNlbWVudCIsIm9uRnJvc21vU3BhUmVhZHkiLCJiaW5kIiwic3RhdGUiLCJmZXRjaFByb21pc2UiLCJpZCIsIkVycm9yIiwid2luZG93IiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImZyb3NtbyIsInNwYSIsInJlcXVlc3RCeVNlbGVjdG9yIiwidGhlbiIsIm1lc3NhZ2VIYW5kbGUiLCJfdGhpczIiLCJzZXRTdGF0ZSIsImNsZWFyTWVzc2FnZSIsImNsZWFyIiwiY2F0Y2giLCJsb2ciLCJjYW5jZWwiLCJhZGRFdmVudExpc3RlbmVyIiwiZWwiLCJyZWZzIiwiZnJvc21vbWVzc2FnZSIsImluc3RhbmNlIiwic2V0VHJhY2thYmxlRWxlbWVudHMiLCJzdGFydFRyYWNraW5nIiwic3RhdGVDbG9uZSIsImVsZW1lbnQiLCJ1c2VGcmFnbWVudCIsIkZyYWdtZW50IiwicmVmIl0sIm1hcHBpbmdzIjoib29FQU1BLElBQU1BLEtBQU8sU0FBQ0MsRUFBS0MsVUFBU0EsRUFBS0MsT0FBTyxTQUFDQyxFQUFLQyxVQUN0Q0osRUFBSUksS0FDSkQsRUFBSUMsR0FBT0osRUFBSUksSUFFWkQsR0FDUixLQ0ZHRSxVQUFZLENBQUMsU0FBVSxZQUFhLGdCQUFpQixpQkFBa0IsVUFBVyxnQkFFbEZDLGVBQWlCLFVBQ2pCQyxlQUFpQixVQUNqQkMs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
